---
title: "EDA _ Producci칩n Cusco"
author: 
  - name: "Proyecto productivo IB"
    avatar: extras/logo/avatar.png
date: "2025-04-06"
output:
  rmdformats::readthedown:
    highlight: kate
    number_sections: false
    code_folding: show
    self_contained: false
    thumbnails: false
    lightbox: false
css: extras/custom.css
---
<style>
body {
text-align: justify}
</style>

```{r setup_datos, include=FALSE}
# Cargar librer칤as necesarias
library(skimr)
library(tidyverse)
library(ggplot2)
library(knitr)
library(corrplot)
library(descriptr)

# Leer el CSV
produccion_cusco <- read_csv("produccion_cusco.csv")

# Verificar estructura de los datos
glimpse(produccion_cusco)
summary(produccion_cusco)
```

![Idea](extras/GERAGRI_CUSCO.jpg)

```{r}
str(produccion_cusco)
```
# 游닄 Medidas de tendencia central y dispersi칩n


```{r}
skim(produccion_cusco)
```


```{r}
# Calcular medias, medianas, desviaciones est치ndar
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  summary()

```


# 游닄 Distribuci칩n de variables

Podemos ver como estan distribuidas las variables a trav칠s de los conocidos boxplots, estos nos muestran como se encuentran los datos distribuidos considerando los cuartiles 1,2,3 para ver cuan denso es una zona de la caja o en los bigotes.

Para este caso se hizo un ajuste a todos los calculos para poder tener una imag칠n referencial de los gr치ficos, puesto que hay algunos datos con valores muy extremos. El ajuste es de un 95% de los primeros valores.



```{r}
# Filtrar por percentil 95 (remueve valores extremos)
produccion_cusco %>%
  select(superficie_verde) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%
  ungroup() %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "lightblue", color = "darkblue", outlier.shape = 16, outlier.size = 2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Diagramas de Caja (sin outliers m치s all치 del percentil 95)",
       x = "Variable", y = "Valor")
```

```{r}
# Filtrar por percentil 95 (remueve valores extremos)
produccion_cusco %>%
  select(cosecha) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%
  ungroup() %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "lightblue", color = "darkblue", outlier.shape = 16, outlier.size = 2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Diagramas de Caja (sin outliers m치s all치 del percentil 95)",
       x = "Variable", y = "Valor")
```

```{r}
# Filtrar por percentil 95 (remueve valores extremos)
produccion_cusco %>%
  select(precio_chacra) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%
  ungroup() %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "lightblue", color = "darkblue", outlier.shape = 16, outlier.size = 2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Diagramas de Caja (sin outliers m치s all치 del percentil 95)",
       x = "Variable", y = "Valor")
```

```{r}
# Filtrar por percentil 95 (remueve valores extremos)
produccion_cusco %>%
  select(rendimiento) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%
  ungroup() %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "lightblue", color = "darkblue", outlier.shape = 16, outlier.size = 2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Diagramas de Caja (sin outliers m치s all치 del percentil 95)",
       x = "Variable", y = "Valor")
```
```{r}
# Filtrar por percentil 95 (remueve valores extremos)
produccion_cusco %>%
  select(produccion) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%
  ungroup() %>%
  ggplot(aes(x = Variable, y = Valor)) +
  geom_boxplot(fill = "lightblue", color = "darkblue", outlier.shape = 16, outlier.size = 2) +
  coord_flip() +
  theme_minimal() +
  labs(title = "Diagramas de Caja (sin outliers m치s all치 del percentil 95)",
       x = "Variable", y = "Valor")
```
```{r}
# Filtrar por percentil 95 (elimina extremos sin perder mucho info)
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95)) %>%  # corte al 90%
  ggplot(aes(x = Valor)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "white") +
  facet_wrap(~ Variable, scales = "free", ncol = 3) +
  theme_minimal() +
  labs(title = "Histogramas sin outliers (percentil 95)",
       x = "Valor", y = "Frecuencia")
```

```{r}
# Gr치ficas de densidad sin outliers extremos (percentil 90)
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Valor") %>%
  group_by(Variable) %>%
  filter(Valor <= quantile(Valor, 0.95, na.rm = TRUE)) %>%  # corte al 90%
  ungroup() %>%
  ggplot(aes(x = Valor, fill = Variable)) +
  geom_density(alpha = 0.6, color = NA) +
  facet_wrap(~ Variable, scales = "free", ncol = 3) +
  theme_minimal() +
  labs(title = "Gr치ficas de Densidad sin Outliers (percentil 95)",
       x = "Valor", y = "Densidad")
```

# 游닄 Correlaci칩n

```{r}
library(GGally)
library(dplyr)

# Matriz de correlaci칩n eliminando outliers extremos (percentil 90)
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  mutate(across(everything(), ~ ifelse(. <= quantile(., 0.90, na.rm = TRUE), ., NA))) %>%
  drop_na() %>%
  ggpairs(title = "Matriz de correlaci칩n sin outliers extremos (percentil 90)")
```

```{r}
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  ggpairs(
    upper = list(continuous = wrap("cor", size = 4)),
    lower = list(continuous = wrap("points", alpha = 0.6, color = "steelblue")),
    diag = list(continuous = wrap("densityDiag", alpha = 0.5, fill = "lightblue"))
  ) +
  ggtitle("Matriz de correlaci칩n con dispersi칩n y densidad (colores tipo densidad)")
```

```{r}
# Matriz de correlaci칩n sin outliers extremos (percentil 90) y con colores
produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion) %>%
  # Filtrar por percentil 90 para cada columna
  mutate(across(everything(), ~ ifelse(. <= quantile(., 0.95, na.rm = TRUE), ., NA))) %>%
  drop_na() %>%
  ggpairs(
    upper = list(continuous = wrap("cor", size = 4)),  # coef. de correlaci칩n
    lower = list(continuous = wrap("points", alpha = 0.6, color = "steelblue")),  # dispersi칩n
    diag = list(continuous = wrap("densityDiag", alpha = 0.5, fill = "lightblue"))  # densidad
  ) +
  ggtitle("Matriz de correlaci칩n sin outliers (percentil 95)")
```



```{r}
# Seleccionar variables num칠ricas
datos_numericos <- produccion_cusco %>%
  select(superficie_verde, siembra, cosecha, rendimiento,
         produccion, precio_chacra, valor_produccion)

# Calcular correlaci칩n
correlacion <- cor(datos_numericos, use = "complete.obs")

# Mostrar matriz
corrplot(correlacion, method = "color", type = "upper", tl.col = "black")

```



![Idea](extras/GERAGRI_CUSCO.jpg)





# 游닇 Conclusiones

Es necesario considerar cu치l ser치 nuestra medida de tendencia central. En este caso en esfec칤fico, nos pudimos dar cuenta de que los valores extremos en la distribuci칩n de datos afectan significativamente a la media, por lo que la mediana ser칤a una medida m치s representativa de nuestros datos.

Por tal raz칩n, al momento de visualizar se observ칩 gr치ficas inadecuadas, teniendo que recurrir a un ajuste de los datos al 95% de los primeros datos, para tener una mejor visualizaci칩n.



